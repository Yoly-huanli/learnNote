[toc]

# 模板编译原理

Vue 其实提供了两个构建版本。

- `vue.js`： 完整版本，包含了模板编译的能力；
- `vue.runtime.js`： 运行时版本，不提供模板编译能力，需要通过 vue-loader 进行提前编译。

vue的模版编译实际上就是把模版编译为render函数，也就是把

```HTML
<div id="test">
  <p>hello</p>
</div>
```

编译为

```js
render(h) {
  return h('div', { id: 'test' }, [h('p','hello')])
},
```

## parse-模版字符串转化为element AST

+ 词法分析: 根据有限状态机，可以逐个字段读取模版字符串，判断是开始标签，还是结束标签，内容是什么，最终转化为

```
{
  tagName: 'div',
  attrs: [],
  unarySlash: '',
  start: 0,
  end: 5
}
{
  tagName: 'div',
  attrs: [],
  unarySlash: '',
  start: 0,
  end: 5
}
```

但是此时没有层级关系

+ 根据开始结束的栈，确定层级关系，是开始标签，就压入栈后，其后的元素是它的child，如果是结束标签就出栈，回到上一个层级的child，最后转化为

  ```
  
  ```

## element AST转化为js AST



## js AST转化为render函数

